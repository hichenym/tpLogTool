# 账号密码配置说明

## 功能概述

为了避免内置账号密码失效导致程序无法使用，新增了账号密码配置功能。用户可以通过设置界面选择使用默认账号或自定义账号密码，配置会保存到Windows注册表中。

## 使用方法

### 1. 打开设置界面

在程序主界面的菜单栏最右侧，点击 **"⚙️"图标按钮**，会弹出设置对话框。

### 2. 配置账号密码

在设置对话框中：

- **使用默认账号**：勾选后使用内置的默认账号密码（账号和密码显示为 `**********`，不可编辑）
- **自定义账号**：取消勾选后可以输入自己的账号密码
  - **账号**：正常显示输入的文本
  - **密码**：使用 `*` 隐藏显示
  - **显示密码**：勾选可以显示密码明文

### 3. 测试连接（可选）

点击 **"测试连接"** 按钮，程序会尝试使用输入的账号密码登录，验证是否有效。

- ✅ 连接成功：账号密码正确，可以正常使用
- ❌ 连接失败：账号密码错误或网络问题

### 4. 保存配置

点击 **"保存"** 按钮，配置会保存到注册表中。下次启动程序时会自动使用保存的配置。

## 配置存储

### 存储位置

配置保存在Windows注册表中：
```
HKEY_CURRENT_USER\Software\TPQueryTool
```

### 存储字段

- `account_env`: 环境（固定为 pro）
- `account_username`: 账号
- `account_password`: 密码（Base64编码）

### 默认配置

程序不再内置默认账号密码，首次使用需要配置账号密码。

如果注册表中没有配置，查询时会提示用户配置账号密码。

## 安全说明

1. **密码编码**：密码使用Base64编码存储在注册表中，不是明文存储
2. **用户隔离**：配置保存在当前用户的注册表中，不同用户互不影响
3. **建议**：不要在共享电脑上保存敏感账号密码

## 常见问题

### Q: 修改配置后需要重启程序吗？
A: 不需要。保存配置后，下次查询时会自动使用新配置。

### Q: 如何恢复默认配置？
A: 程序不再提供默认账号密码，请在设置界面中输入您自己的账号密码。

### Q: 配置丢失怎么办？
A: 如果配置丢失，查询时会提示您重新配置账号密码。

### Q: 可以配置多个账号吗？
A: 目前只支持配置一个账号。如需切换账号，在设置界面修改后保存即可。

### Q: 为什么没有环境选择？
A: 为了简化配置，程序固定使用生产环境。

## 技术细节

### 配置读取优先级

```
注册表配置 > 硬编码默认值
```

### 相关函数

- `get_account_config()`: 读取账号配置
- `save_account_config(env, username, password)`: 保存账号配置
- `SettingsDialog`: 设置对话框类

### 代码位置

所有账号密码相关的代码都在 `main.py` 文件中：
- 第 54-68 行：配置读取函数
- 第 70-78 行：配置保存函数
- 第 96-240 行：设置对话框类

## 更新日志

### v1.1.1 (2026-01-17)
- 🐛 修复重复定义save_account_config函数的问题
- 🔧 改进异常处理，使用具体异常类型
- 🛡️ 增强线程清理机制，防止崩溃
- ⏱️ 添加网络请求超时（5秒）
- 📝 优化错误日志输出
- 💪 提升代码健壮性和稳定性

### v1.1.0 (2026-01-17)
- ✨ 新增账号密码配置功能
- ✨ 新增设置界面
- ✨ 新增测试连接功能
- 🔒 密码Base64编码存储
- 📝 配置保存到注册表
- 🎨 设置按钮仅显示图标
- 🔧 固定使用生产环境
- 🔐 移除硬编码默认账号密码，提升安全性
