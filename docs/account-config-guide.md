# 账号密码配置说明

## 功能概述

为了支持不同系统的账号管理，程序提供了独立的账号密码配置功能。用户可以分别配置运维系统账号和固件系统账号，配置会保存到Windows注册表中。

## 使用方法

### 1. 打开设置界面

在程序主界面的菜单栏最右侧，点击 **"⚙️"图标按钮**，会弹出设置对话框。

### 2. 配置账号密码

设置对话框使用标签页分离两个系统的账号配置：

#### 运维账号标签页
- 用于设备查询、唤醒、重启等运维功能
- **账号**：输入运维系统账号
- **密码**：输入运维系统密码（使用 `*` 隐藏显示）
- **显示密码**：勾选可以显示密码明文

#### 固件账号标签页
- 用于固件查询、新增、修改、删除等固件管理功能
- **账号**：输入固件系统账号
- **密码**：输入固件系统密码（使用 `*` 隐藏显示）
- **显示密码**：勾选可以显示密码明文

### 3. 测试连接（可选）

点击 **"测试连接"** 按钮，程序会根据当前选中的标签页测试对应系统的账号：

- 在"运维账号"标签页：测试运维系统连接
- 在"固件账号"标签页：测试固件系统连接

测试结果：
- ✅ 连接成功：账号密码正确，可以正常使用
- ❌ 连接失败：账号密码错误或网络问题

### 4. 保存配置

点击 **"保存"** 按钮，配置会保存到注册表中。

**保存规则：**
- 可以两个账号都不填（首次使用）
- 可以只填运维账号（只用设备查询功能）
- 可以只填固件账号（只用固件管理功能）
- 可以两个都填（使用全部功能）
- 单个系统的账号和密码必须同时填写或同时为空

## 配置存储

### 存储位置

配置保存在Windows注册表中：
```
HKEY_CURRENT_USER\Software\TPQueryTool
```

### 存储字段

**运维账号：**
- `account_env`: 环境（固定为 pro）
- `account_username`: 账号
- `account_password`: 密码（Base64编码）

**固件账号：**
- `firmware_username`: 账号
- `firmware_password`: 密码（Base64编码）

### 默认配置

程序不再内置默认账号密码，首次使用需要配置账号密码。

如果注册表中没有配置，使用对应功能时会提示用户配置账号密码。

## 未配置提示

### 运维账号未配置
当查询设备时，如果运维账号未配置，会弹出提示：
```
检测到运维系统账号信息未配置，点击OK前往配置。
```
点击OK会自动打开设置对话框并切换到"运维账号"标签页。

### 固件账号未配置
当查询或新增固件时，如果固件账号未配置，会弹出提示：
```
检测到固件系统账号信息未配置，点击OK前往配置。
```
点击OK会自动打开设置对话框并切换到"固件账号"标签页。

## 安全说明

1. **密码编码**：密码使用Base64编码存储在注册表中，不是明文存储
2. **用户隔离**：配置保存在当前用户的注册表中，不同用户互不影响
3. **建议**：不要在共享电脑上保存敏感账号密码

## 常见问题

### Q: 修改配置后需要重启程序吗？
A: 不需要。保存配置后，下次查询时会自动使用新配置。

### Q: 如何恢复默认配置？
A: 程序不再提供默认账号密码，请在设置界面中输入您自己的账号密码。

### Q: 配置丢失怎么办？
A: 如果配置丢失，使用对应功能时会提示您重新配置账号密码。

### Q: 可以只配置一个系统的账号吗？
A: 可以。您可以根据需要只配置运维账号或只配置固件账号，也可以两个都配置。

### Q: 为什么没有环境选择？
A: 为了简化配置，程序固定使用生产环境。

### Q: 两个系统的账号可以相同吗？
A: 可以，但通常两个系统使用不同的账号体系。

## 技术细节

### 配置读取优先级

```
注册表配置 > 空值（提示用户配置）
```

### 相关函数

**运维账号：**
- `get_account_config()`: 读取运维账号配置
- `save_account_config(env, username, password)`: 保存运维账号配置

**固件账号：**
- `get_firmware_account_config()`: 读取固件账号配置
- `save_firmware_account_config(username, password)`: 保存固件账号配置

**设置对话框：**
- `SettingsDialog`: 设置对话框类（使用标签页）

### 代码位置

- 配置管理：`query_tool/utils/config.py`
- 设置对话框：`query_tool/widgets/custom_widgets.py`
- 固件API：`query_tool/utils/firmware_api.py`

## 更新日志

### v1.2.0 (2026-02-07)
- ✨ 新增固件账号独立配置
- ✨ 使用标签页分离运维账号和固件账号
- ✨ 支持灵活配置（可只配置一个或两个都配置）
- ✨ 未配置时自动引导用户到对应标签页
- 🎨 优化标签页样式（选中时高亮显示）
- 🔒 移除固件系统硬编码账号密码
- 📝 固件账号配置保存到独立注册表键

### v1.1.1 (2026-01-17)
- 🐛 修复重复定义save_account_config函数的问题
- 🔧 改进异常处理，使用具体异常类型
- 🛡️ 增强线程清理机制，防止崩溃
- ⏱️ 添加网络请求超时（5秒）
- 📝 优化错误日志输出
- 💪 提升代码健壮性和稳定性

### v1.1.0 (2026-01-17)
- ✨ 新增账号密码配置功能
- ✨ 新增设置界面
- ✨ 新增测试连接功能
- 🔒 密码Base64编码存储
- 📝 配置保存到注册表
- 🎨 设置按钮仅显示图标
- 🔧 固定使用生产环境
- 🔐 移除硬编码默认账号密码，提升安全性
